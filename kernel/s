#!/bin/bash
name=vagrant
TIMEOUT=5

sudo cgcreate -g memory:/333 -t $name:$name -a $name:$name

sudo cgcreate -g memory:/444 -t $name:$name -a $name:$name

echo 100000000 | sudo tee /sys/fs/cgroup/memory/333/memory.limit_in_bytes
echo 100000000 | sudo tee /sys/fs/cgroup/memory/444/memory.limit_in_bytes

sudo dmesg -C
echo "Under CGROUP"
sudo perf stat cgexec -g memory:/333 stress -m 1 --timeout $TIMEOUT --vm-keep -q --vm-bytes 110000000

echo "Under Normal"
sudo perf stat cgexec -g memory:/444 stress -m 1 --timeout $TIMEOUT --vm-keep -q --vm-bytes 110000000
